# ТЕХНИЧЕСКОЕ ЗАДАНИЕ: Система «Контент-машина» (MVP)

**Стек:** n8n (Self-hosted), Claude (API), GPT (API), HeyGen (API)

## 1. СУТЬ И ЦЕЛЬ ПРОЕКТА

Создание автоматизированного конвейера на базе n8n, который выполняет три функции:

- **Мониторинг:** Поиск трендовых тем и виральных роликов в нише.
- **Генерация:** Трансформация мыслей эксперта в медиа-пакеты (текст + ИИ-аватар).
- **Публикация:** Максимальный охват (от текстовых до видео площадок с адаптацией под формат соц.сети)
- **Аналитика:** Сбор данных по охватам и вовлеченности для корректировки стратегии.

**Требование:** Вся логика (workflows) разворачивается на сервере Заказчика. Подрядчик передает настроенные сценарии n8n и промпты в полную собственность Заказчика (No Vendor Lock-in).

## 2. ТЕХНИЧЕСКАЯ АРХИТЕКТУРА И ИНСТРУМЕНТЫ

Система реализуется как набор сценариев (workflows) в n8n, развернутом в Docker на сервере Заказчика.

| Компонент | Инструмент | Задача |
|-----------|------------|--------|
| Оркестрация | n8n (Self-hosted) | Логика пайплайна, управление очередями, интеграции. |
| Вход | Telegram Bot | Прием голоса и текста от эксперта. |
| Транскрипция | OpenAI Whisper v3 | Перевод аудио в текст с сохранением пунктуации. |
| Генерация текста | Anthropic Claude 3.5 | Создание основного тела постов (стиль, смысл). |
| Заголовки / Hooks | OpenAI GPT-4o | Продающие заголовки, кликбейтные крючки. |
| Видео-контент | HeyGen (API) | Генерация видео с ИИ-аватаром эксперта. |
| База данных | PostgreSQL | Версионирование контента, логирование, хранение ID публикаций. |

Отклонение от указанного стека допускается с обоснованием эквивалентности (по функционалу, переносимости и правам).

## 3. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 3.1. Модуль поиска трендов (Парсинг)

Система должна ежедневно выполнять сбор данных по конкурентам и хештегам в:

- **Видео-тренды:** Релевантные и трендовые для социальных сетей
- **Визуальные тренды:** (популярные пины в нише).
- **Текстовые тренды:** (обсуждаемые темы).
- **Отчет эксперту:** Список из 3–5 идей со ссылками и анализом «почему это актуально» (Claude).

### 3.2. Пайплайн обработки (Workflow)

- **Прием данных:** Бот принимает голос (до 10 мин) или текст.
- **Транскрибация и Анализ:** Перевод в текст, выделение ключевых тезисов, фактов и структуры.
- **Генерация Текста:**
  - Claude: формирует тело поста (без «канцелярита», в стиле эксперта).
  - GPT: генерирует 5 вариантов заголовков и 3 хука.
- **Генерация Видео:**
  - Система готовит скрипт, отправляет запрос в HeyGen (аккаунт Заказчика).
  - Формат 9:16, наложенные субтитры, аватар эксперта.
- **Модерация:** Сообщение в ТГ-чат с полным пакетом ассетов и кнопками управления.
- **Доставка (Режимы):**
  - Автопубликация: там, где есть официальное API.
  - Полуавтомат: система выдает готовый пакет (видео + текст + хештеги) для ручного постинга, если API недоступно.

### 3.3. Видеоформаты (Требования к HeyGen)

Система должна генерировать видео следующих параметров:

- **Основной формат:** Vertical Video (9:16).
- **Разрешение:** 1080x1920 (Full HD).
- **Контейнер:** MP4 (H.264).
- **Субтитры:** Обязательное наложение «сгоревших» (burnt-in) субтитров с выделением ключевых слов цветом.
- **Продолжительность:** Автоматическая обрезка/подгонка скрипта под лимиты:
  - до 60 сек;
  - до 90-180 сек.

### 3.4. Площадки и форматы дистрибуции

| Формат контента | Тип публикации |
|-----------------|----------------|
| Видео + текст + хештеги | Полуавтомат / API |
| Вертикальное видео + заголовок + описание | Полуавтомат / API |
| Короткий «крючок» + основной тезис (тред) | Авто (через API) |
| Видео-пин (Idea Pin) + ссылка + заголовок | Авто / API |
| Пост с форматированием (Markdown) | Авто (Bot API) |
| Видео + адаптированная статья (H1, списки) | Полуавтомат / API |

### 3.5. Модуль Аналитики

Сбор данных через 24/72 часа: просмотры, репосты, лайки. Вывод Dashboard в Telegram (Топ постов недели).

### 3.6. Хранение и версионирование

Система обязана сохранять в БД для каждой единицы контента:

- Исходный аудиофайл/текст и полный транскрипт.
- Все промежуточные версии текста (отклоненные и правки).
- Финальную опубликованную версию и прямую ссылку на публикацию (или ID).
- Удаление данных запрещено, только перевод в статус «Архив».

## 4. ЮРИДИЧЕСКИЕ ТРЕБОВАНИЯ И IP (ANTI VENDOR LOCK-IN)

### 4.1. Формат передачи и права:

- Все сценарии (JSON n8n) и промпты передаются Заказчику в полную собственность (ст. 1296 ГК РФ).
- **Запрет кастомных нод:** Запрещено использовать закрытые ноды Подрядчика. Все workflows должны работать на стандартной сборке n8n или с передачей исходного кода нод.

### 4.2. ИИ-Аватар (HeyGen):

- Аватар создается исключительно внутри аккаунта HeyGen Заказчика.
- Подрядчик не имеет прав на использование аватара или исходников эксперта вне проекта.

## 5. ЭТАПЫ РЕАЛИЗАЦИИ И ПРИЕМКА

| Этап | Результат | Критерий приёмки |
|------|-----------|------------------|
| 1. Инфраструктура | Развернут n8n и БД. Настроен бэкап. n8n + БД + Парсеры | Доступ у Заказчика, бэкап создается ежедневно (JSON + БД). |
| 2. Текстовый блок | Workflow транскрипции и генерации. | Текст соответствует стилю эксперта, 80% без правок. |
| 3. Видео и Очереди | Интеграция с HeyGen + управление очередью. | Задачи не теряются при нагрузке, видео генерируется по скрипту. |
| 4. Handover | Настройка сбора метрик и передача доступов. Система в промышленной эксплуатации. | Заказчик самостоятельно меняет промпты и ведет публикации. |

## 6. КРИТЕРИИ КАЧЕСТВА И ОТВЕТСТВЕННОСТЬ

### 6.1. Определение брака (Запрещено):

- Галлюцинации (добавление фактов, которых не было в исходнике).
- Использование «ИИ-клише» (приглашаем в увлекательное путешествие, в современном мире и т.д.).
- Технический брак: рассинхрон звука и губ аватара, обрыв текста, нарушение лимитов символов.

### 6.2. Отказоустойчивость и Идемпотентность:

- При сбое API (HeyGen/Claude) система логирует ошибку и ставит задачу на паузу.
- Повторный запуск workflow не должен приводить к дублированию постов (Idempotency).
- При превышении лимитов (Rate Limits) система реализует очередь (Queue) с отложенным стартом.

## 7. ОБЯЗАТЕЛЬСТВА ЗАКАЗЧИКА

- Предоставить сервер (от 4 vCPU / 8 GB RAM) и доступ к Docker.
- Оплатить балансы API (OpenAI, Anthropic, HeyGen).
- Видео-материалы для обучения аватара HeyGen.
- Проект считается завершенным только после проведения Handover-сессии: передачи всех доступов и обучения Заказчика работе с промптами без участия Подрядчика.

---

## ВАЖНО:

**Подрядчик отвечает за корректность работы пайплайна, интеграций и логики автоматизации.** Подрядчик не отвечает за:

- изменения API сторонних сервисов,
- блокировки аккаунтов соцсетей при соблюдении описанных режимов, но обязан реализовать обработку ошибок и уведомления.

Просим предоставить коммерческое предложение по формату:

- сроки по каждому этапу (п.5),
- стоимость по этапам,
- что именно передаётся Заказчику на каждом этапе (артефакты),
- какие ограничения/риски видите в реализации данного ТЗ.

